def battle_to_observation(battle):
    obs = {
        "turn": battle.turn,
        "weather": str(battle.weather),
        "fields": [str(f) for f in battle.fields],
        "side_conditions": [str(c) for c in battle.side_conditions],
        "my_active": None,
        "opponent_active": None,
        "available_moves": [],
        "available_switches": [],
        "can_tera": battle.can_tera,
    }

    my_mon = battle.active_pokemon
    if my_mon:
        obs["my_active"] = {
            "species": my_mon.species,
            "hp_frac": my_mon.current_hp_fraction,
            "types": [str(t) for t in my_mon.types if t],
            "status": str(my_mon.status),
            "boosts": dict(my_mon.boosts),
        }

    opp_mon = battle.opponent_active_pokemon
    if opp_mon:
        obs["opponent_active"] = {
            "species": opp_mon.species,
            "hp_frac": opp_mon.current_hp_fraction,
            "types": [str(t) for t in opp_mon.types if t],
            "status": str(opp_mon.status),
            "boosts": dict(opp_mon.boosts),
        }

    for m in battle.available_moves:
        obs["available_moves"].append({
            "id": m.id,
            "base_power": m.base_power,
            "type": str(m.type),
            "accuracy": m.accuracy,
            "category": str(m.category),
            "priority": m.priority,
            "pp_frac": m.current_pp / m.max_pp,  # optional RL info
        })

    obs["available_switches"] = [
        {
            "species": mon.species,
            "hp_frac": mon.current_hp_fraction,
            "status": str(mon.status),
        } 
        for mon in battle.available_switches
    ]

    return obs
